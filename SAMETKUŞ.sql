CREATE DATABASE SAMET1
GO
USE SAMET1

CREATE TABLE BOLGELER (
    BOLGEID INT PRIMARY KEY,
    BOLGEADİ VARCHAR(50)
);


CREATE TABLE SEHİRLER (
    SEHİRID INT PRIMARY KEY,
    SEHİRADİ VARCHAR(50),
    BOLGEID INT,
    ETKİLENEN_ŞEHİRLER VARCHAR(50),
    FOREIGN KEY (BOLGEID) REFERENCES BOLGELER(BOLGEID)
);


CREATE TABLE İLCELER(
    İLCEID INT PRIMARY KEY,
    İLCEADİ VARCHAR(50),
    SEHİRID INT,
    FOREIGN KEY (SEHİRID) REFERENCES SEHİRLER(SEHİRID)
);

CREATE TABLE MAHALLELER (
    MAHALLEID INT PRIMARY KEY,
    MAHALLEADİ VARCHAR(50) NOT NULL,
    İLCEID INT,
    FOREIGN KEY (İLCEID) REFERENCES İLCELER(İLCEID)
);

CREATE TABLE DEPREMKAYITLARI (
    KAYITID INT PRIMARY KEY,
    TARİH DATE,
    BUYUKLUK FLOAT,
    MERKEZÜSSÜ VARCHAR(100),
	FAYHATTI VARCHAR(100),
	DERİNLİK FLOAT,
);

CREATE TABLE BİNATÜRLERİ (
    TÜRID INT PRIMARY KEY,
    TÜRADİ VARCHAR(50) NOT NULL,
);

CREATE TABLE BİNADURUMLARI (
   DURUMID INT PRIMARY KEY,
    DURUMU VARCHAR(50),
);

CREATE TABLE BİNAGÜÇLENDİRMEYÖNTEMLERİ (
    YONTEMID INT PRIMARY KEY,
    YONTEMADİ VARCHAR(50)
);

CREATE TABLE BİNALAR (
    BİNAID INT PRIMARY KEY,
    BİNAADİ VARCHAR(50),
    TÜRID INT,
    DURUMID INT,
    MAHALLEID INT,
    FOREIGN KEY (TÜRID) REFERENCES BİNATÜRLERİ(TÜRID),
    FOREIGN KEY (DURUMID) REFERENCES BİNADURUMLARI(DURUMID),
    FOREIGN KEY (MAHALLEID) REFERENCES MAHALLELER(MAHALLEID)
);
CREATE TABLE BİNADEPREMBİLGİLER (
    BİNAID INT,
    KAYITID INT,
    HASARSEVİYE VARCHAR(20),
    PRIMARY KEY (BİNAID, KAYITID),
    FOREIGN KEY (BİNAID) REFERENCES BİNALAR(BİNAID),
    FOREIGN KEY (KAYITID) REFERENCES DEPREMKAYITLARI(KAYITID)
);
CREATE TABLE DEPREMÖNCESİANALİZ (
   ANALİZID INT PRIMARY KEY,
   TARİH DATE,
   MAHALLEID INT,
    FOREIGN KEY (MAHALLEID) REFERENCES MAHALLELER(MAHALLEID)
);
CREATE TABLE ACİLDURUMPLANI (
    PLANID INT PRIMARY KEY,
    PLANN VARCHAR(50),
    ANALİZID INT,
    FOREIGN KEY (ANALİZID) REFERENCES DEPREMÖNCESİANALİZ(ANALİZID)
);
CREATE TABLE KURTARMAEKİPLERİ (
    EKİPID INT PRIMARY KEY,
    GOREVADİ VARCHAR(50)
);
CREATE TABLE EĞİTİM (
    KURUMID INT PRIMARY KEY,
    KURUMADİ VARCHAR(50),
    MAHALLEID INT,
	OKUL_DURUMU VARCHAR(50),
    FOREIGN KEY (MAHALLEID) REFERENCES MAHALLELER(MAHALLEID)
);
CREATE TABLE SAĞLIK (
    SAĞLIKID INT PRIMARY KEY,
    HASTANEADİ VARCHAR(50),
	YOĞUN_BAKIM_HASTA_SAYISI INT,
	ÖLÜ_SAYISI INT,
	YARALI_SAYISI INT,
    MAHALLEID INT,
    FOREIGN KEY (MAHALLEID) REFERENCES MAHALLELER(MAHALLEID)
);
CREATE TABLE İDARİBİRİM (
    BİRİMID INT PRIMARY KEY,
    BİRİMADİ VARCHAR(50),
    İLCEID INT,
	BAKANLIK VARCHAR(50),
    FOREIGN KEY (İLCEID) REFERENCES İLCELER(İLCEID)
);
CREATE TABLE DEPREMARACLARI(
    ARACID INT PRIMARY KEY,
    ARACADİ VARCHAR(50),
    AÇIKLAMA VARCHAR(250),
    MİKTAR INT,
    DEPOYERİ VARCHAR(100),
    SATINALINMATARİHİ DATE,
    SONKULLANIMYERİ VARCHAR(50),
    DURUM VARCHAR(20)	
	CHECK (DURUM IN ('STOKTA', 'KULLANIMDA', 'ARIZALI')),
    MAHALLEID INT,
    FOREIGN KEY (MAHALLEID) REFERENCES MAHALLELER(MAHALLEID)
);
CREATE TABLE EVYAPİMALZEMELERİ (
    MALZEMEID INT PRIMARY KEY,
    YÖNETMELİK_MALZEMEADİ VARCHAR(50),
    MALZEMETURU VARCHAR(50),
    URETICIFRİMA VARCHAR(100),
	İNŞAATFİRMAİSİM VARCHAR(100),
    URETIMTARİHİ DATE,
    KULLANILANPROJEID INT,
	YIKILANBLOK VARCHAR(100),
	KULLANILAN_MALZEME VARCHAR(50),
	
    FOREIGN KEY (KULLANILANPROJEID) REFERENCES DEPREMÖNCESİANALİZ(ANALİZID)
);
INSERT INTO BOLGELER (BOLGEID, BOLGEADİ)	
VALUES
(1, 'AKDENİZ'),
(2, 'MARMARA'),
(3, 'DOĞU ANADOLU BÖLGESİ');

INSERT INTO SEHİRLER (SEHİRID, SEHİRADİ, BOLGEID,ETKİLENEN_ŞEHİRLER)	
VALUES
(1, 'KAHRAMANMARAŞ', 1,'HATAY'),
(2, 'KOCAELİ', 2,'SAKARYA'),
(3, 'ELAZIĞ', 3,'MALATYA');

INSERT INTO İLCELER (İLCEID, İLCEADİ, SEHİRID)	
VALUES
(1, 'ELBİSTAN', 1),
(2, 'GÖLCÜK', 2),
(3, 'MERKEZ', 3);

INSERT INTO MAHALLELER (MAHALLEID, MAHALLEADİ, İLCEID)	
VALUES
(1, 'PAZARCIK', 1),
(2, 'MERKEZ', 2),
(3, 'ÇEVRİMTAŞ', 3);

INSERT INTO DEPREMKAYITLARI (KAYITID, TARİH, BUYUKLUK, MERKEZÜSSÜ,FAYHATTI,DERİNLİK)	
VALUES
(1, '2023-02-06', 7.6, 'KAHRAMANMARAŞ','DOĞU ANADOLU FAY HATTI',5.0),
(2, '1999-07-17', 7.4, 'KOCAELİ','KUZEY ANADOLU FAY HATTI',17.0),
(3, '2020-01-24', 6.8, 'ELAZIĞ','DOĞU ANADOLU FAY HATTI',4.8);

INSERT INTO BİNATÜRLERİ (TÜRID, TÜRADİ)		
VALUES
(1, 'EBRAR SİTESİ'),
(2, 'APARTMAN'),
(3, 'OFİS');

INSERT INTO BİNADURUMLARI (DURUMID, DURUMU)		
VALUES
(1, 'YIKILMIŞ'),
(2, 'YIKILMIŞ'),
(3, 'HASARSIZ');

INSERT INTO BİNAGÜÇLENDİRMEYÖNTEMLERİ (YONTEMID, YONTEMADİ)		
VALUES
(1, 'YÖNETMELİĞE UYGUN İNŞAAT YAPILACAK '),
(2, 'YÖNETMELİĞE UYGUN İNŞAAT YAPILACAK'),
(3, 'Temel Güçlendirmesi');

INSERT INTO BİNALAR (BİNAID, BİNAADİ, TÜRID, DURUMID, MAHALLEID)	
VALUES
(1, 'SİTE', 1, 1, 1),
(2, 'APARTMAN', 2, 2, 2),
(3, 'OFİS', 3, 3, 3);

INSERT INTO BİNADEPREMBİLGİLER (BİNAID, KAYITID, HASARSEVİYE)	
VALUES
(1, 1, 'AĞIR HASARLI'),
(2, 2, 'AĞIR HASARLI'),
(3, 3, 'ORTA HASARLI');

INSERT INTO DEPREMÖNCESİANALİZ (ANALİZID, TARİH, MAHALLEID)		
VALUES
(1, '2019-04-01', 1),
(2, '1990-09-05', 2),
(3, '2017-03-17', 3);

INSERT INTO ACİLDURUMPLANI (PLANID, PLANN, ANALİZID)	
VALUES
(1, 'DEPREM ANINDA YAPILACAKLAR', 1),
(2, 'DEPREM ANINDA YAPILACAKLAR', 2),
(3, 'YANGIN ANINDA YAPILACAKLAR', 3);

INSERT INTO KURTARMAEKİPLERİ (EKİPID, GOREVADİ)		
VALUES
(1, 'Arama KURTARMA EKİPLERİ'),
(2, 'ARAMA KURTARMA KÖPEKLERİ'),
(3, 'İLK YARDIM EKİPLERİ');

INSERT INTO EĞİTİM (KURUMID, KURUMADİ, MAHALLEID,OKUL_DURUMU)	
VALUES
(1, 'ZAİM İLKOKULU', 1,'İYİ'),
(2, 'TOKİ ORTAOKULU', 2,'HASARLI'),
(3, 'DERİNCE ANADOLU LİSESİ', 3,'YIKILMIŞ');

INSERT INTO SAĞLIK (SAĞLIKID, HASTANEADİ, MAHALLEID,YOĞUN_BAKIM_HASTA_SAYISI,YARALI_SAYISI,ÖLÜ_SAYISI)	
VALUES
(1, 'HATAY EĞİTİM ARAŞTIRMA HASTANESİ ', 1,14,1000,21),
(2, 'KOCAELİ SAĞLIK OCAĞI', 2,20,500,15),
(3, 'ELAZIĞ HASTANESİ', 3,24,5,1);

INSERT INTO İDARİBİRİM (BİRİMID, BİRİMADİ, İLCEID,BAKANLIK)	
VALUES
(1, 'Belediye İdari Birimi', 1,'İÇİŞLERİ BAKANLIĞI'),
(2, 'Kaymakamlık', 2,'SAĞLIK BAKANLIĞI'),
(3, 'Valilik', 3,'İÇİŞLERİ BAKANLIĞI');

INSERT INTO DEPREMARACLARI (ARACID, ARACADİ, AÇIKLAMA, MİKTAR, DEPOYERİ, SATINALINMATARİHİ, SONKULLANIMYERİ, DURUM, MAHALLEID)	
VALUES
(1, 'KURTARMA ARACI ', 'ARAMA VE KURTARMA', 5, 'DEPO A BLOK', '2024-01-01', '2023-05-09', 'STOKTA', 1),
(2, 'YANGIN SÖNDÜRME ARACI', 'YANGIN SÖNDÜRME ', 3, 'DEPO B BLOK', '2022-02-01', '2020-01-21', 'KULLANIMDA', 2),
(3, 'İLK YARDIM ARACI', 'ACİL DURUMLAR', 2, 'DEPO C BLOK', '2023-03-01', '2023-09-21', 'ARIZALI', 3);

INSERT INTO EVYAPİMALZEMELERİ (MALZEMEID,YÖNETMELİK_MALZEMEADİ, MALZEMETURU, URETICIFRİMA, İNŞAATFİRMAİSİM, URETIMTARİHİ, KULLANILANPROJEID,YIKILANBLOK,KULLANILAN_MALZEME)	
VALUES
(1, 'ÇİMENTO', 'İnşaat Malzemesi', ' ANTİS YAPI', 'OTELCİLİK TAŞIMACILIK İNŞAAT ', '2022-01-01', 1,'Grand İSİAS OTEL','DENİZ KUMU'),
(2, 'ÇELİK', 'İnşaat Malzemesi', 'AKYURT YAPI ', 'AKYURT İNŞAAT', '2019-02-01', 2,'ROYAL SİTESİ','TUĞLA'),
(3, 'Tuğla', 'İnşaat Malzemesi', 'Fevzi Yılmaz YAPI', 'Fevzi Yılmaz İNŞAAT', '1998-03-01', 3,'RÖNESANS REZİDANS','DENİZ KUMU')	
;

SELECT COUNT(*) AS DepremSayisi
FROM DEPREMKAYITLARI;
GO 
SELECT MAX(BUYUKLUK) AS ENBUYUK FROM DEPREMKAYITLARI WHERE BUYUKLUK > 7.0 

SELECT * FROM BOLGELER;
SELECT * FROM SEHİRLER;
SELECT * FROM İLCELER;
SELECT * FROM MAHALLELER;
SELECT * FROM DEPREMKAYITLARI;
SELECT * FROM BİNATÜRLERİ;
SELECT * FROM BİNADURUMLARI;
SELECT * FROM BİNAGÜÇLENDİRMEYÖNTEMLERİ;
SELECT * FROM BİNALAR;
SELECT * FROM BİNADEPREMBİLGİLER;
SELECT * FROM DEPREMÖNCESİANALİZ;
SELECT * FROM ACİLDURUMPLANI;
SELECT * FROM KURTARMAEKİPLERİ;
SELECT * FROM EĞİTİM;
SELECT * FROM SAĞLIK;
SELECT * FROM İDARİBİRİM;
SELECT * FROM DEPREMARACLARI;
SELECT * FROM EVYAPİMALZEMELERİ;
go
/* BÜYÜKLÜK 7,0 DAN BÜYÜKSE BÜYÜK DEPREM OLDU MESAJI VEREN SORGUYU TRİGGERI*/
CREATE TRIGGER KAYITT    -- 2.TRİGGER KULLANIMI 
ON DEPREMKAYITLARI
AFTER INSERT
AS
BEGIN
    IF EXISTS (SELECT 1 FROM inserted WHERE BUYUKLUK > 7.0)
    BEGIN
        PRINT 'BÜYÜK BİR DEPREM OLDU'; 
    END;
	END;
	go
	/* BİNALAR TABLOSUNA YENİ BİR BİNA EKLENDİĞİNDE BİNA EKLENDİ TRİGGERI*/
	CREATE TRIGGER Ekleme --1.TRİGGER KULLANIMI
ON BİNALAR
AFTER INSERT
AS
BEGIN
    PRINT 'BİNA EKLENDİ';
END;
